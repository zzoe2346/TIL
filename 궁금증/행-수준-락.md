# 행 수준 락(row-level locking)이란

행 수준 락(row-level locking)은 데이터베이스에서 동시성 제어를 위해 사용되는 기법 중 하나로, 데이터베이스의 테이블에서 특정 행(row) 단위로 락을 설정하는 것을 말합니다. 이는 동시성 제어와 데이터 무결성을 유지하면서도 높은 성능을 제공하기 위해 중요한 역할을 합니다. 행 수준 락은 특히 InnoDB와 같은 트랜잭션을 지원하는 스토리지 엔진에서 사용됩니다.

### 행 수준 락의 특징

1. **정밀한 락킹**: 행 수준 락은 테이블의 특정 행에만 락을 설정하기 때문에, 다른 행들은 동시에 접근하고 수정할 수 있습니다. 이는 테이블 수준 락(table-level locking)에 비해 훨씬 더 세밀한 락킹 메커니즘입니다.
   
2. **높은 동시성**: 여러 사용자가 동시에 데이터베이스를 읽고 쓸 수 있도록 해줍니다. 예를 들어, 한 사용자가 특정 행을 수정하고 있는 동안에도 다른 사용자는 다른 행을 자유롭게 수정할 수 있습니다.

3. **데드락 가능성**: 세밀한 락킹으로 인해 데드락(deadlock)이 발생할 가능성이 있습니다. 데드락은 두 개 이상의 트랜잭션이 서로 상대방의 락이 해제되기를 기다리는 상황입니다. 데이터베이스 시스템은 데드락을 감지하고 해결하기 위해 트랜잭션을 롤백하는 등의 방법을 사용합니다.

### 행 수준 락의 사용

행 수준 락은 주로 다음과 같은 경우에 사용됩니다:

- **트랜잭션 격리 수준**: 트랜잭션이 동시에 실행되더라도 일관된 데이터를 보장하기 위해 다양한 격리 수준(isolation level)이 제공됩니다. 대표적인 격리 수준으로는 READ COMMITTED, REPEATABLE READ, SERIALIZABLE 등이 있습니다. 이 격리 수준은 행 수준 락을 통해 구현됩니다.
  
- **다중 사용자 환경**: 많은 사용자가 동시에 데이터베이스에 접근하여 데이터를 수정하는 경우, 행 수준 락은 성능 저하를 최소화하면서 데이터 무결성을 유지합니다.

### 예시

다음은 InnoDB 스토리지 엔진을 사용하는 MySQL 데이터베이스에서 행 수준 락을 사용하는 예시입니다:

```sql
-- 트랜잭션 시작
START TRANSACTION;

-- 특정 행에 대한 업데이트 쿼리 (이 행에 대한 행 수준 락이 설정됨)
UPDATE employees SET salary = salary + 1000 WHERE employee_id = 123;

-- 트랜잭션 커밋
COMMIT;
```

위의 예시에서, `employee_id`가 123인 행은 트랜잭션이 완료될 때까지 다른 트랜잭션에서 수정할 수 없습니다. 다른 트랜잭션은 이 행에 접근할 수 없으므로 데이터 무결성이 유지됩니다.

### 결론

행 수준 락은 데이터베이스 관리 시스템에서 중요한 동시성 제어 메커니즘으로, 트랜잭션이 서로 영향을 미치지 않도록 하면서도 높은 성능을 제공하는 데 필수적입니다. InnoDB와 같은 스토리지 엔진에서 행 수준 락을 사용하면, 복잡한 트랜잭션 처리와 다중 사용자 환경에서도 데이터 무결성을 유지하면서 효율적으로 데이터를 관리할 수 있습니다.